(window.webpackJsonp=window.webpackJsonp||[]).push([[90],{745:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"ion_virtual_scroll",(function(){return VirtualScroll}));var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),_core_ca0488fc_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(109),createNode=(__webpack_require__(7),function(el,type){var template=getTemplate(el,type);return template&&el.ownerDocument?el.ownerDocument.importNode(template.content,!0).children[0]:null}),getTemplate=function(el,type){switch(type){case"item":return el.querySelector("template:not([name])");case"header":return el.querySelector("template[name=header]");case"footer":return el.querySelector("template[name=footer]")}},calcCells=function(items,itemHeight,headerHeight,footerHeight,headerFn,footerFn,approxHeaderHeight,approxFooterHeight,approxItemHeight,j,offset,len){for(var cells=[],end=len+offset,i=offset;i<end;i++){var value,item=items[i];if(headerFn)null!=(value=headerFn(item,i,items))&&cells.push({i:j++,type:"header",value:value,index:i,height:headerHeight?headerHeight(value,i):approxHeaderHeight,reads:headerHeight?0:2,visible:!!headerHeight});if(cells.push({i:j++,type:"item",value:item,index:i,height:itemHeight?itemHeight(item,i):approxItemHeight,reads:itemHeight?0:2,visible:!!itemHeight}),footerFn)null!=(value=footerFn(item,i,items))&&cells.push({i:j++,type:"footer",value:value,index:i,height:footerHeight?footerHeight(value,i):approxFooterHeight,reads:footerHeight?0:2,visible:!!footerHeight})}return cells},VirtualScroll=function(){function class_1(hostRef){var _this=this;Object(_core_ca0488fc_js__WEBPACK_IMPORTED_MODULE_1__.l)(this,hostRef),this.range={offset:0,length:0},this.viewportHeight=0,this.cells=[],this.virtualDom=[],this.isEnabled=!1,this.viewportOffset=0,this.currentScrollTop=0,this.indexDirty=0,this.lastItemLen=0,this.totalHeight=0,this.approxItemHeight=45,this.approxHeaderHeight=30,this.approxFooterHeight=30,this.onScroll=function(){_this.updateVirtualScroll()}}return class_1.prototype.itemsChanged=function(){this.calcCells(),this.updateVirtualScroll()},class_1.prototype.connectedCallback=function(){return Object(tslib__WEBPACK_IMPORTED_MODULE_0__.a)(this,void 0,void 0,(function(){var contentEl,_a;return Object(tslib__WEBPACK_IMPORTED_MODULE_0__.c)(this,(function(_b){switch(_b.label){case 0:return(contentEl=this.el.closest("ion-content"))?(_a=this,[4,contentEl.getScrollElement()]):(console.error("<ion-virtual-scroll> must be used inside an <ion-content>"),[2]);case 1:return _a.scrollEl=_b.sent(),this.contentEl=contentEl,this.calcCells(),this.updateState(),[2]}}))}))},class_1.prototype.componentDidUpdate=function(){this.updateState()},class_1.prototype.disconnectedCallback=function(){this.scrollEl=void 0},class_1.prototype.onResize=function(){this.calcCells(),this.updateVirtualScroll()},class_1.prototype.positionForItem=function(index){return Promise.resolve(function(index,cells,heightIndex){var cell=cells.find((function(c){return"item"===c.type&&c.index===index}));return cell?heightIndex[cell.i]:-1}(index,this.cells,this.getHeightIndex()))},class_1.prototype.checkRange=function(offset,len){return void 0===len&&(len=-1),Object(tslib__WEBPACK_IMPORTED_MODULE_0__.a)(this,void 0,void 0,(function(){var length,cellIndex,cells;return Object(tslib__WEBPACK_IMPORTED_MODULE_0__.c)(this,(function(_a){return this.items?(length=-1===len?this.items.length-offset:len,cellIndex=function(cells,index){var max=cells.length>0?cells[cells.length-1].index:0;return 0===index?0:index===max+1?cells.length:cells.findIndex((function(c){return c.index===index}))}(this.cells,offset),cells=calcCells(this.items,this.itemHeight,this.headerHeight,this.footerHeight,this.headerFn,this.footerFn,this.approxHeaderHeight,this.approxFooterHeight,this.approxItemHeight,cellIndex,offset,length),this.cells=function(dst,src,offset){if(0===offset&&src.length>=dst.length)return src;for(var i=0;i<src.length;i++)dst[i+offset]=src[i];return dst}(this.cells,cells,cellIndex),this.lastItemLen=this.items.length,this.indexDirty=Math.max(offset-1,0),this.scheduleUpdate(),[2]):[2]}))}))},class_1.prototype.checkEnd=function(){return Object(tslib__WEBPACK_IMPORTED_MODULE_0__.a)(this,void 0,void 0,(function(){return Object(tslib__WEBPACK_IMPORTED_MODULE_0__.c)(this,(function(_a){return this.items&&this.checkRange(this.lastItemLen),[2]}))}))},class_1.prototype.updateVirtualScroll=function(){this.isEnabled&&this.scrollEl&&(this.timerUpdate&&(clearTimeout(this.timerUpdate),this.timerUpdate=void 0),Object(_core_ca0488fc_js__WEBPACK_IMPORTED_MODULE_1__.g)(this.readVS.bind(this)),Object(_core_ca0488fc_js__WEBPACK_IMPORTED_MODULE_1__.m)(this.writeVS.bind(this)))},class_1.prototype.readVS=function(){for(var contentEl=this.contentEl,scrollEl=this.scrollEl,topOffset=0,node=this.el;node&&node!==contentEl;)topOffset+=node.offsetTop,node=node.parentElement;this.viewportOffset=topOffset,scrollEl&&(this.viewportHeight=scrollEl.offsetHeight,this.currentScrollTop=scrollEl.scrollTop)},class_1.prototype.writeVS=function(){var dirtyIndex=this.indexDirty,viewport=function(scrollTop,vierportHeight,margin){return{top:Math.max(scrollTop-margin,0),bottom:scrollTop+vierportHeight+margin}}(this.currentScrollTop-this.viewportOffset,this.viewportHeight,100),heightIndex=this.getHeightIndex(),range=function(heightIndex,viewport,buffer){for(var topPos=viewport.top,bottomPos=viewport.bottom,i=0;i<heightIndex.length&&!(heightIndex[i]>topPos);i++);for(var offset=Math.max(i-buffer-1,0);i<heightIndex.length&&!(heightIndex[i]>=bottomPos);i++);return{offset:offset,length:Math.min(i+buffer,heightIndex.length)-offset}}(heightIndex,viewport,2);(function(dirtyIndex,currentRange,range){return dirtyIndex<=range.offset+range.length||currentRange.offset!==range.offset||currentRange.length!==range.length})(dirtyIndex,this.range,range)&&(this.range=range,function(dom,heightIndex,cells,range){for(var _i=0,dom_1=dom;_i<dom_1.length;_i++){var node=dom_1[_i];node.change=0,node.d=!0}for(var toMutate=[],end=range.offset+range.length,_loop_1=function(i){var cell=cells[i],node=dom.find((function(n){return n.d&&n.cell===cell}));if(node){var top=heightIndex[i];top!==node.top&&(node.top=top,node.change=1),node.d=!1}else toMutate.push(cell)},i=range.offset;i<end;i++)_loop_1(i);for(var pool=dom.filter((function(n){return n.d})),_loop_2=function(cell){var node=pool.find((function(n){return n.d&&n.cell.type===cell.type})),index=cell.i;node?(node.d=!1,node.change=2,node.cell=cell,node.top=heightIndex[index]):dom.push({d:!1,cell:cell,visible:!0,change:2,top:heightIndex[index]})},_a=0,toMutate_1=toMutate;_a<toMutate_1.length;_a++){_loop_2(toMutate_1[_a])}dom.filter((function(n){return n.d&&-9999!==n.top})).forEach((function(n){n.change=1,n.top=-9999}))}(this.virtualDom,heightIndex,this.cells,range),this.nodeRender?function(el,nodeRender,dom,updateCellHeight){for(var child,children=Array.from(el.children).filter((function(n){return"TEMPLATE"!==n.tagName})),childrenNu=children.length,i=0;i<dom.length;i++){var node=dom[i],cell=node.cell;if(2===node.change){if(i<childrenNu)nodeRender(child=children[i],cell,i);else{var newChild=createNode(el,cell.type);(child=nodeRender(newChild,cell,i)||newChild).classList.add("virtual-item"),el.appendChild(child)}child.$ionCell=cell}else child=children[i];0!==node.change&&(child.style.transform="translate3d(0,"+node.top+"px,0)");var visible=cell.visible;node.visible!==visible&&(visible?child.classList.remove("virtual-loading"):child.classList.add("virtual-loading"),node.visible=visible),cell.reads>0&&(updateCellHeight(cell,child),cell.reads--)}}(this.el,this.nodeRender,this.virtualDom,this.updateCellHeight.bind(this)):this.domRender?this.domRender(this.virtualDom):this.renderItem&&this.el.forceUpdate())},class_1.prototype.updateCellHeight=function(cell,node){var _this=this,update=function(){if(node.$ionCell===cell){var style=window.getComputedStyle(node),height=node.offsetHeight+parseFloat(style.getPropertyValue("margin-bottom"));_this.setCellHeight(cell,height)}};node&&node.componentOnReady?node.componentOnReady().then(update):update()},class_1.prototype.setCellHeight=function(cell,height){var index=cell.i;cell===this.cells[index]&&(cell.height===height&&!0===cell.visible||(cell.visible=!0,cell.height=height,this.indexDirty=Math.min(this.indexDirty,index),this.scheduleUpdate()))},class_1.prototype.scheduleUpdate=function(){var _this=this;clearTimeout(this.timerUpdate),this.timerUpdate=setTimeout((function(){return _this.updateVirtualScroll()}),100)},class_1.prototype.updateState=function(){var shouldEnable=!(!this.scrollEl||!this.cells);shouldEnable!==this.isEnabled&&(this.enableScrollEvents(shouldEnable),shouldEnable&&this.updateVirtualScroll())},class_1.prototype.calcCells=function(){this.items&&(this.lastItemLen=this.items.length,this.cells=calcCells(this.items,this.itemHeight,this.headerHeight,this.footerHeight,this.headerFn,this.footerFn,this.approxHeaderHeight,this.approxFooterHeight,this.approxItemHeight,0,0,this.lastItemLen),this.indexDirty=0)},class_1.prototype.getHeightIndex=function(){return this.indexDirty!==1/0&&this.calcHeightIndex(this.indexDirty),this.heightIndex},class_1.prototype.calcHeightIndex=function(index){void 0===index&&(index=0),this.heightIndex=function(buf,len){if(!buf)return new Uint32Array(len);if(buf.length===len)return buf;if(len>buf.length){var newBuf=new Uint32Array(len);return newBuf.set(buf),newBuf}return buf.subarray(0,len)}(this.heightIndex,this.cells.length),this.totalHeight=function(buf,cells,index){for(var acum=buf[index],i=index;i<buf.length;i++)buf[i]=acum,acum+=cells[i].height;return acum}(this.heightIndex,this.cells,index),this.indexDirty=1/0},class_1.prototype.enableScrollEvents=function(shouldListen){var _this=this;this.rmEvent&&(this.rmEvent(),this.rmEvent=void 0);var scrollEl=this.scrollEl;scrollEl&&(this.isEnabled=shouldListen,scrollEl.addEventListener("scroll",this.onScroll),this.rmEvent=function(){scrollEl.removeEventListener("scroll",_this.onScroll)})},class_1.prototype.renderVirtualNode=function(node){var _a=node.cell,type=_a.type,value=_a.value,index=_a.index;switch(type){case"item":return this.renderItem(value,index);case"header":return this.renderHeader(value,index);case"footer":return this.renderFooter(value,index)}},class_1.prototype.render=function(){var _this=this;return Object(_core_ca0488fc_js__WEBPACK_IMPORTED_MODULE_1__.i)(_core_ca0488fc_js__WEBPACK_IMPORTED_MODULE_1__.a,{style:{height:this.totalHeight+"px"}},this.renderItem&&Object(_core_ca0488fc_js__WEBPACK_IMPORTED_MODULE_1__.i)(VirtualProxy,{dom:this.virtualDom},this.virtualDom.map((function(node){return _this.renderVirtualNode(node)}))))},Object.defineProperty(class_1.prototype,"el",{get:function(){return Object(_core_ca0488fc_js__WEBPACK_IMPORTED_MODULE_1__.f)(this)},enumerable:!0,configurable:!0}),Object.defineProperty(class_1,"watchers",{get:function(){return{itemHeight:["itemsChanged"],headerHeight:["itemsChanged"],footerHeight:["itemsChanged"],items:["itemsChanged"]}},enumerable:!0,configurable:!0}),Object.defineProperty(class_1,"style",{get:function(){return"ion-virtual-scroll{display:block;position:relative;width:100%;contain:strict;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}ion-virtual-scroll>.virtual-loading{opacity:0}ion-virtual-scroll>.virtual-item{position:absolute!important;top:0!important;right:0!important;left:0!important;-webkit-transition-duration:0ms;transition-duration:0ms;will-change:transform}"},enumerable:!0,configurable:!0}),class_1}(),VirtualProxy=function(_a,children,utils){var dom=_a.dom;return utils.map(children,(function(child,i){var node=dom[i],vattrs=child.vattrs||{},classes=vattrs.class||"";return classes+="virtual-item ",node.visible||(classes+="virtual-loading"),Object.assign(Object.assign({},child),{vattrs:Object.assign(Object.assign({},vattrs),{class:classes,style:Object.assign(Object.assign({},vattrs.style),{transform:"translate3d(0,"+node.top+"px,0)"})})})}))}}}]);
//# sourceMappingURL=90.b51f01cd59879ff3cd07.bundle.js.map